<%- include('../partials/header', { title: 'My Orders' }) %>

<div class="my-orders-container">
    <h1>My Orders</h1>

    <% if (orders.length > 0) { %>
        <div class="order-list">
            <% orders.forEach(order => { %>
                <div class="order-card status-<%= order.status.toLowerCase().replace(/ /g, '-') %>">
                     <div class="order-header">
                         <div><strong>Order ID:</strong> <%= order._id %></div>
                        <div><strong>Placed on:</strong> <%= order.formattedOrderDate %></div>
                        <div><strong>Total:</strong> $<%= order.totalAmount.toFixed(2) %></div>
                         <div><strong>Status:</strong> <span class="order-status"><%= order.status %></span></div>
                     </div>
                    <div class="order-body">
                         <div class="order-items-preview">
                             <% order.products.slice(0, 3).forEach(item => { %>
                                 <img src="<%= item.imageUrl %>" alt="<%= item.name %>" title="<%= item.name %> (Qty: <%= item.quantity %>)">
                             <% }) %>
                             <% if(order.products.length > 3) { %><span class="more-items">+ <%= order.products.length - 3 %> more</span><% } %>
                        </div>
                        <div class="order-details">
                             <p><strong>Shipping To:</strong> <%= order.shippingAddress.name %>, <%= order.shippingAddress.cityVillage %>, Pin: <%= order.shippingAddress.pincode %></p>
                             <p><strong>Delivered By:</strong> <%= order.formattedReceivedDate %></p>
                              <p><strong>Assigned:</strong> <%= order.assignedAdminEmail || 'Not Assigned Yet' %></p>
                         </div>
                    </div>
                     <div class="order-actions">
                        <% if (order.isCancellable) { %>
                            <form action="/orders/cancel/<%= order._id %>" method="POST" onsubmit="return confirm('Are you sure you want to cancel this order?');">
                                <button type="submit" class="btn btn-danger">Cancel Order</button>
                             </form>
                         <% } else if (order.status === 'Pending') { %>
                             <small class="text-muted">Cancellation window expired or order processing.</small>
                         <% } %>

                     </div>
                </div>
            <% }) %>
        </div>
    <% } else { %>
        <p>You haven't placed any orders yet. <a href="/">Start Shopping!</a></p>
    <% } %>
</div>

<%- include('../partials/footer') %>

