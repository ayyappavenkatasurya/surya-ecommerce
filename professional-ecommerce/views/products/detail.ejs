 <%- include('../partials/header', { title: product.name }) %>

 <div class="product-detail-container">
    <div class="product-detail-main">
         <div class="product-detail-image">
            <img src="<%= product.imageUrl %>" alt="<%= product.name %>">
         </div>
        <div class="product-detail-info">
             <h1><%= product.name %></h1>
             <p class="detail-price">$<%= product.price.toFixed(2) %></p>
            <p class="detail-stock">Available Stock: <%= product.stock %></p>

            <% if (product.numReviews > 0) { %>
                 <p class="detail-rating">
                     Rating:
                    <% for(let i=1; i<=5; i++) { %>
                        <i class="fas fa-star<%= i <= product.averageRating ? '' : (i - 0.5 <= product.averageRating ? '-half-alt' : '-regular') %>"></i>
                    <% } %>
                     (<%= product.numReviews %> reviews) | <%= product.orderCount %> Ordered
                 </p>
             <% } else { %>
                 <p class="detail-rating">No reviews yet | <%= product.orderCount %> Ordered</p>
             <% } %>

             <p>Seller: <%= product.sellerEmail %></p>

            <div class="product-actions">
                 <form action="/user/cart/add" method="POST" style="display: inline-block; margin-right: 10px;">
                    <input type="hidden" name="productId" value="<%= product._id %>">
                     <div class="quantity-selector">
                        <label for="quantity">Qty:</label>
                         <input type="number" id="quantity" name="quantity" value="1" min="1" max="<%= product.stock %>" required>
                     </div>
                     <button type="submit" class="btn btn-primary" <%= product.stock <= 0 ? 'disabled' : '' %>>
                         <i class="fas fa-cart-plus"></i> <%= product.stock <= 0 ? 'Out of Stock' : 'Add to Cart' %>
                     </button>
                </form>

                  <% if (product.stock > 0) { %>
                  <form action="/user/cart/add?redirectTo=checkout" method="POST" style="display: inline-block;">
                        <input type="hidden" name="productId" value="<%= product._id %>">
                        <input type="hidden" name="quantity" value="1">
                       <button type="submit" class="btn btn-success">Buy Now</button>
                     </form>
                  <% } else {%>
                    <button class="btn btn-success" disabled>Buy Now</button>
                  <% } %>

            </div>

             <div class="share-buttons">
                 Share: <a href="#" onclick="alert('Share functionality to be implemented'); return false;"><i class="fas fa-share-alt"></i> All Share Options</a>
             </div>


            <div class="product-specifications">
                 <h3>Specifications</h3>
                 <pre><%= product.specifications || 'No specifications provided.' %></pre>
             </div>
        </div>
     </div>

    <div class="product-rating-section">
         <h3>Rate This Product</h3>
         <% if (userCanRate) { %>
             <form action="/products/<%= product._id %>/rate" method="POST">
                 <div class="rating-stars">
                     <% for (let i = 5; i >= 1; i--) { %>
                        <input type="radio" id="star<%= i %>" name="rating" value="<%= i %>" <%= userRating === i ? 'checked' : '' %> required>
                        <label for="star<%= i %>" title="<%= i %> stars"><i class="fas fa-star"></i></label>
                     <% } %>
                 </div>
                 <button type="submit" class="btn btn-primary">Submit Rating</button>
             </form>
         <% } else { %>
            <p><a href="/auth/login?returnTo=<%= encodeURIComponent(currentUrl) %>">Login</a> to rate this product.</p>
         <% } %>
    </div>

     <% if (product.ratings && product.ratings.length > 0) { %>
        <div class="product-reviews">
             <h3>Customer Reviews</h3>
         </div>
     <% } %>

</div>

 <%- include('../partials/footer') %>
