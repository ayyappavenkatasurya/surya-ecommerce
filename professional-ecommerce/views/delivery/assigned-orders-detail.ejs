<%- include('../partials/header', { title: title }) %>

<div class="delivery-orders-detail-container admin-manage-container">
    <h1><%= title %></h1>
     <p><a href="/delivery/dashboard">&laquo; Back to Delivery Dashboard</a></p>


    <% if (orders.length > 0) { %>
        <table class="data-table">
            <thead>
                <tr>
                     <th>Order ID</th>
                     <th>Placed Date</th>
                    <th>Customer</th>
                     <th>Address & Phone</th>
                    <th>Items</th>
                     <th>Status</th>
                     <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% orders.forEach(order => { %>
                    <tr>
                         <td><%= order._id %></td>
                         <td><%= order.formattedOrderDate %></td>
                         <td><%= order.shippingAddress.name %></td>
                         <td>
                            <%= order.shippingAddress.cityVillage %>, <%= order.shippingAddress.pincode %>
                             <br>Ph: <%= order.shippingAddress.phone %>
                             <br><small>Landmark: <%= order.shippingAddress.landmarkNearby || 'N/A' %></small>
                        </td>
                         <td><%= order.products.map(p => `${p.name} (x${p.quantity})`).join(', ').substring(0, 50) %>...</td>
                        <td>
                            <span class="status-badge status-<%= order.status.toLowerCase().replace(/ /g, '-') %>"><%= order.status %></span>
                            <% if(order.status === 'Delivered' && order.formattedReceivedDate) { %>
                                 <br><small>(Delivered: <%= order.formattedReceivedDate %>)</small>
                            <% } %>
                         </td>
                        <td class="actions-cell">
                            <% if (order.canMarkDelivered) { %>
                                <form action="/delivery/orders/mark-delivered/<%= order._id %>" method="POST" class="inline-form" onsubmit="return confirm('Mark order <%= order._id %> as Delivered?')">
                                    <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-check-double"></i> Mark Delivered</button>
                                 </form>
                            <% } %>

                         </td>
                    </tr>
                <% }) %>
            </tbody>
         </table>
     <% } else { %>
         <p>No orders found matching this criteria.</p>
     <% } %>
</div>

<%- include('../partials/footer') %>
