<%# views/admin/edit-category.ejs %>
<%- include('../partials/header', { title: title }) %>

<div class="admin-manage-container">
    <h1><%= title %></h1>

    <form action="/admin/categories/update/<%= category._id %>" method="POST" class="form-submit-spinner" style="max-width: 600px;">
        <div class="form-group">
            <label for="name">Category Name:</label>
            <input type="text" id="name" name="name" class="form-control" value="<%= category.name %>" required maxlength="50">
        </div>

        <div class="form-group">
            <label for="imageUrl">Image URL:</label>
            <input type="url" id="imageUrl" name="imageUrl" class="form-control" value="<%= category.imageUrl %>" required>
             <img id="imagePreview" src="<%= category.imageUrl %>" alt="Current Image Preview" style="max-width: 100px; margin-top: 10px; display: block; border:1px solid #ccc; padding:2px;"/>
        </div>

         <p class="small text-muted">Created By: <%= category.createdBy?.name || 'N/A' %> on <%= formatDateIST(category.createdAt) %></p>

        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Update Category</button>
        <a href="/admin/manage-categories" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
    // Simple image preview (same as add form)
    const imageUrlInput = document.getElementById('imageUrl');
    const imagePreview = document.getElementById('imagePreview');

    function updatePreview() {
        const url = imageUrlInput.value;
        if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
            imagePreview.src = url;
            imagePreview.style.display = 'block';
             imagePreview.onerror = function() {
                 imagePreview.style.display = 'none';
                 console.warn("Preview failed to load image URL.");
            }
        } else {
            imagePreview.style.display = 'none';
        }
    }
    if(imageUrlInput) {
         imageUrlInput.addEventListener('input', updatePreview);
    }
</script>


<%- include('../partials/footer') %>