<%# views/admin/add-category.ejs %>
<%- include('../partials/header', { title: title }) %>

<div class="admin-manage-container">
    <h1><%= title %></h1>

    <form action="/admin/categories/new" method="POST" class="form-submit-spinner" style="max-width: 600px;">
        <div class="form-group">
            <label for="name">Category Name:</label>
            <input type="text" id="name" name="name" class="form-control" value="<%= typeof category !== 'undefined' ? category.name : '' %>" required maxlength="50">
        </div>

        <div class="form-group">
            <label for="imageUrl">Image URL:</label>
            <input type="url" id="imageUrl" name="imageUrl" class="form-control" placeholder="https://example.com/category-image.jpg" value="<%= typeof category !== 'undefined' ? category.imageUrl : '' %>" required>
             <%# Optional: Add simple image preview on change/load %>
             <img id="imagePreview" src="#" alt="Image Preview" style="max-width: 100px; margin-top: 10px; display: none; border:1px solid #ccc; padding:2px;"/>
        </div>

        <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Category</button>
        <a href="/admin/manage-categories" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
    // Simple image preview
    const imageUrlInput = document.getElementById('imageUrl');
    const imagePreview = document.getElementById('imagePreview');

    function updatePreview() {
        const url = imageUrlInput.value;
        if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
            imagePreview.src = url;
            imagePreview.style.display = 'block';
             // Optional: Check if image loads
            imagePreview.onerror = function() {
                 imagePreview.style.display = 'none';
                console.warn("Preview failed to load image URL.");
            }
        } else {
            imagePreview.style.display = 'none';
        }
    }

    if(imageUrlInput) {
         imageUrlInput.addEventListener('input', updatePreview);
        // Show preview on page load if URL exists
         if (imageUrlInput.value) {
            updatePreview();
         }
    }
</script>

<%- include('../partials/footer') %>
