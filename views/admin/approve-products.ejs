<%# views/admin/approve-products.ejs %>
<%- include('../partials/header', { title: 'Approve Products' }) %>

<div class="admin-manage-container container"> <%# Added container class %>
    <h1>Approve Products</h1>
    <p class="text-muted mb-3">Review products uploaded or updated by sellers.</p>

   <% if (products.length > 0) { %>
       <div class="table-container card">
           <table class="data-table">
               <thead>
                   <tr>
                       <th>Image</th>
                       <th>Name / Category</th>
                       <th>Seller</th>
                       <th>Price / Stock</th>
                       <th>Submitted</th>
                       <th class="actions-cell" style="text-align: right;">Actions</th>
                   </tr>
                </thead>
                <tbody>
                   <% products.forEach(product => { %>
                       <tr>
                           <td data-label="Image">
                               <a href="/products/<%= product._id %>" target="_blank" title="View Product Details (Opens New Tab)">
                                   <img src="<%= product.imageUrl %>" alt="<%= product.name %>" class="table-img">
                               </a>
                           </td>
                           <td data-label="Name / Category">
                               <%= product.name %><br>
                               <small class="text-muted"><%= product.category %></small>
                           </td>
                            <td data-label="Seller">
                                <%= product.sellerId ? product.sellerId.name : 'N/A' %><br>
                                <small class="text-muted"><%= product.sellerId ? product.sellerId.email : 'N/A' %></small>
                            </td>
                            <td data-label="Price / Stock" style="white-space: nowrap;">
                                â‚¹<%= product.price.toFixed(2) %><br>
                                <small class="text-muted">Stock: <%= product.stock %></small>
                           </td>
                            <td data-label="Submitted"><%= formatDateIST(product.updatedAt) %></td> <%# Use updatedAt as it reflects last submission/update %>

                            <td data-label="Actions" class="actions-cell">
                               <%# Approve Form %>
                               <form action="/admin/products/<%= product._id %>/approve" method="POST" class="inline-form form-submit-spinner" style="margin-bottom: 5px;">
                                    <button type="submit" class="btn btn-success btn-sm" title="Approve this product">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                               </form>

                               <%# Reject Form (with reason) %>
                               <form action="/admin/products/<%= product._id %>/reject" method="POST" class="inline-form form-submit-spinner">
                                    <div style="display: flex; gap: 5px; align-items: center;">
                                        <input type="text" name="rejectionReason" placeholder="Rejection Reason (Required)" required class="form-control form-control-sm" style="min-width: 150px;">
                                        <button type="submit" class="btn btn-danger btn-sm" title="Reject this product">
                                            <i class="fas fa-times"></i> Reject
                                        </button>
                                    </div>
                               </form>
                           </td>
                        </tr>
                    <% }) %>
               </tbody>
            </table>
       </div>
   <% } else { %>
        <p class="alert alert-info mt-3">No products are currently pending approval.</p>
   <% } %>
    <div class="mt-3">
         <a href="/admin/manage-products" class="btn btn-secondary">View All Products</a>
         <a href="/admin/dashboard" class="btn btn-outline-secondary">Back to Admin Dashboard</a>
    </div>
</div>

<%- include('../partials/footer') %>