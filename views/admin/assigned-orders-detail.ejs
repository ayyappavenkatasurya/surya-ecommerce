<%# views/admin/assigned-orders-detail.ejs %>
<%- include('../partials/header', { title: title }) %>

<div class="admin-manage-container">
    <h1><%= title %></h1>
    <%# Link might be invalid now if /admin/manage-assigned-orders was removed %>
    <p><a href="/admin/manage-assigned-orders">« Back to Delivery Admin Overview</a></p>

    <% if (orders.length > 0) { %>
        <div class="table-container card"> <%# Added wrapper %>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Order ID</th>
                        <th>Placed Date</th>
                        <th>Customer Email</th>
                        <th>Address</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Delivered Date</th>
                    </tr>
                </thead>
                <tbody>
                    <% orders.forEach(order => { %>
                        <tr>
                            <td data-label="Image"> <%# Added data-label %>
                                <% if (order.products && order.products.length > 0 && order.products[0].imageUrl) { %>
                                    <%# Ensure productId exists before creating link %>
                                    <% if (order.products[0].productId) { %>
                                        <a href="/products/<%= order.products[0].productId %>">
                                            <img src="<%= order.products[0].imageUrl %>" alt="<%= order.products[0].name %>" class="table-img">
                                        </a>
                                    <% } else { %>
                                        <img src="<%= order.products[0].imageUrl %>" alt="<%= order.products[0].name %>" class="table-img">
                                    <% } %>
                                <% } else { %>
                                    <span class="text-muted">N/A</span>
                                <% } %>
                            </td>
                            <td data-label="Order ID"><%= order._id %></td>
                            <%# --- USE HELPER --- %>
                            <td data-label="Placed Date"><%= formatDateIST(order.orderDate) %></td>
                            <td data-label="Customer Email"><%= order.userEmail %></td>
                            <td data-label="Address">
                                <%= order.shippingAddress.name %>, <%= order.shippingAddress.cityVillage %>, <%= order.shippingAddress.pincode %>
                                <br>Ph: <%= order.shippingAddress.phone %>
                            </td>
                            <td data-label="Items">
                                <% if (order.products && order.products.length > 0) { %>
                                    <%= order.products[0].name %> (x<%= order.products[0].quantity %>)
                                    <% if (order.products.length > 1) { %>
                                        <br><small>+ <%= order.products.length - 1 %> more item(s)</small>
                                    <% } %>
                                <% } else { %>
                                    No items found
                                <% } %>
                            </td>
                            <td data-label="Total">₹<%= order.totalAmount.toFixed(2) %></td>
                            <td data-label="Status"><span class="status-badge status-<%= order.status.toLowerCase().replace(/ /g, '-') %>"><%= order.status %></span></td>
                            <%# --- USE HELPER --- %>
                            <td data-label="Delivered Date"><%= formatDateIST(order.receivedByDate) %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    <% } else { %>
        <p>No orders found matching this criteria for <%= deliveryAdminEmail %>.</p>
    <% } %>
</div>

<%- include('../partials/footer') %>